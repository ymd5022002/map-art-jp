<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang ="ja">
<head>
  <title>干渉色変換ツール(お試し版)</title>
  <meta http-equiv="Content-Language" content="ja">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
</head>
<body bgcolor="#FCE3CD" text="#663236" > <!--HTML5非推奨記載なので別途CSSに移行予定-->        
<!-- link="リンク文字色 " alink="選択中リンク文字色" vlink="訪問済みリンク文字色"> -->
<div>
<h2 style="display:inline;">干渉色変換ツール</h2>　
<b>#世界を干渉色に</b><h2 style="display:inline;"> </h2>
<br>
画像を素敵な虹色の干渉色に変換するツールです
<br>
<br>
<!-- 画像入力 -->
<span><b>変換したい画像</b></span><small>　(tiff形式は対応しておりません)</small>
<br>
<input type="file" id="selectfile" accept='image/*'><input type="button" id="btn1" value="クリア" onclick="fileReset();">
<br>
<!-- ネガ -->
<input id="negativeCheckBox1" type="checkbox" onchange="negativeImage();"><small>ネガ</small>

<!-- 縮小チェック -->
<input type="checkbox" id="imgShrink" onclick="fileReset();" checked><small>縮小サイズ<sup>＊</sup></small>
<small>(＊要再選択)</small><br>
<!-- 仕切り -->
<div id="separator" style="border: 5; margin: 2px; background-color: #FCE3CD; min-height: 1px;"></div>
<!-- 繰返し回数 -->
<span><b>繰返し回数</b></span> 
<input id="repeatTimes" type="number" value="1" min="0" step="0.1" style="width:45px;" onkeyup="this.nextSibling.value = this.value; " onchange ="interferanceColorFilter();"/><input id="repeatTimesSlider" type="range" value="1" min="0" max="10" step="0.1" oninput="this.previousSibling.value = this.value; " onchange ="interferanceColorFilter();" />
<input id="fineCheckBox1" type="checkbox" onchange="fineRepeatTimesStep();"><small>微調</small>
<br> 
<span style = "font-size:small">　(最小から最大輝度の間に干渉色を何周繰返すか)</span>
<br>
<!-- 位相 -->
<span><b>位相(%)</b></span>
<input id="phaseRate" type="number" value="0" min="0" step="1"style="width:45px;" onkeyup="this.nextSibling.value = this.value; " onchange ="interferanceColorFilter();"/><input id="phaseRateSlider" type="range" value="0" min="0" max="100" step="1" oninput="this.previousSibling.value = this.value; " onchange ="interferanceColorFilter();" />
<input id="fineCheckBox2" type="checkbox" onchange="finePhaseRateStep();"><small>微調</small>
<br>
<span style = "font-size:small">　(干渉色の位相のずらし量:0-99%)</span>
<br>
<!-- 仕切り -->
<div id="separator" style="border: 5; margin: 5px; background-color: #FCE3CD; min-height: 3px;"></div>

<!-- 表示サイズ -->
表示サイズ<input type="button" value ="＋" id="large" onclick="changeSize(dispRatio= 2**0.25)"><input type="button" value ="－" id="small" onclick="changeSize(dispRatio= 2**(-0.25))">
　位置<input type="button" value ="たて" id="alignVertical" onclick="alignVertical()"><input type="button" value ="よこ" id="alignHorizontal" onclick="alignHorizontal()">
<input type="button" value ="⇔" id="swap" onclick="swap()">
<br>
<div id="separator" style="border: 5; margin: 5px; background-color: #FCE3CD; min-height: 3px;"></div>
<span id="output">
<span><b>画像変換結果｜　<a href='#' download='#' id="save">保存</a>　｜</b></span><br>

<!-- 仕切り -->
<hr size="1">
<div id="separator" style="border: 5; margin: 5px; background-color: #FCE3CD; min-height: 3px;"></div>

<!-- 合成 blend-->

<small>
<b>合成</b> 
<select id="blend_type" style="width:70px;">
<option value="standard" selected ;>通常</option>
<option value="multiple">乗算</option>
<option value="pinLight">ピンライト</option>
<option value="blight">比較(明)</option>
<option value="dark">比較(暗)</option>
<option value="overlay">オーバーレイ[要検証]</option>
</select>

　不透明度<input id="blend_rate" type="number" value="100" min="0" max="100" step="1" style="width:40px;"
onkeyup="this.nextSibling.value = this.value; "
onchange ="interferanceColorFilter();"/><input id="blendRateSlider" type="range"
value="100" min="0" max="100" step="1" oninput="this.previousSibling.value = this.value; "
style="width:120px;" onchange ="interferanceColorFilter();" />
</small>
<br>

<!-- ボケ　Gaussian 【未実装】-->
<!-- <small><b>ボケ</b></small>
<input id="kernel_size" type="number" value="1" min="2" step="1"
style="width:40px;" onkeyup="this.nextSibling.value = this.value; " 
onchange ="interferanceColorFilter();"/><input id="kernel_size‗slider" 
type="range" value="1" min="1" step="2" oninput="this.previousSibling.value = this.value; "
onchange ="interferanceColorFilter();" style="width:50px;" />
<br> -->

<!-- 変換結果表示部 -->
<img style='vertical-align:middle;' id='srcImg'><span id="newLine"></span><img style='vertical-align:middle;' id='dstImg'>
</span> 
<br>
<!-- 計算用のCanvas(非表示) -->
<canvas id="srcCanvas" hidden></canvas>
<canvas id="dstCanvas" hidden></canvas>
<div id="separator" style="border: 5; margin: 5px; background-color: #FCE3CD; min-height: 3px;"></div>
</div>
<hr size="1">
&copy;<a href="https://ymd5022002.github.io/map-art-jp/" target="_blank">地図アート研究所</a><small>(MapArtResearch)</small>
｜<a href="https://github.com/ymd5022002/map-art-jp/blob/gh-pages/ice_converter/index.html" target="_blank"><small>ソース</small></a>
<br>

<script>
//グレースケールを干渉色に変換するルックアップテーブルを作成する関数            
function makeLUTable(repeatTimes, phaseRate){  
  let LUTable = [];
  //////干渉色パラメータ
  let t_iC = [0.64 , 0.35 , 0.355];    //振幅　amplitude
  let c_iC = [ 0.5 , 0.5 , 0.5];       //中心値
  let u_iC = [ 0.5 , 0.52 , 0.5];      //位相率
  let k_iC = [ 2.98 , 3.71 , 4.35];    //波数
  let s_iC = [ 0.105 , 0. , 0.];       //波長増加率
  let alpha_iC = [ 0.2 , 0.53 , 0.5];  //包絡振幅
  let delta_iC = [ 0.5 , 0.1 , 0.042]; //包絡位相率
  let beta_iC  = [ 0.7 , 0.45 , 0.35]; //包絡波数
  let cycle = repeatTimes;             //色繰返し回数
  let fullscale = 255.;                //画像輝度の最大値(最大は何メートルか)
  let Num_iC = fullscale / cycle;      //色１周期で輝度幾つか(色１周期で何メートルか）
  let scale  = 1000. / fullscale;      //画像輝度値の幅を1000に規格化する係数
  let r_iC = 0.15;                     //不使用階調率(15%)

  for (let Y = 0; Y < 256; Y++) {
    let n_iC = (Y + (phaseRate / 100. * 256.) / repeatTimes ) % Num_iC ;           //色一周期の何番目か
    for (let i = 0; i < 3; i++ ){
      LUTable[Y * 3 + i] =
        c_iC[i] +
        t_iC[i] *
          (1 +
            alpha_iC[i] *
              Math.cos(
                (2 * Math.PI * beta_iC[i] * (n_iC / Num_iC + r_iC)) /
                  (1 + r_iC) -
                  2 * Math.PI * delta_iC[i]
              )) *
          Math.cos(
            (2 *
              Math.PI *
              (1 + (s_iC[i] * (n_iC / Num_iC + r_iC)) / (1 + r_iC)) *
              k_iC[i] *
              (n_iC / Num_iC + r_iC)) /
              (1 + r_iC) -
              2 * Math.PI * u_iC[i]
          );
      if ( LUTable[Y*3 + i] > 0.0031308 ){
        LUTable[Y*3 + i] = 1.055 * ( LUTable[Y*3 + i] ** (1/2.4) ) - 0.055;
      }else{
        LUTable[Y*3 + i] = 12.92 * LUTable[Y*3 + i];
      }
      LUTable[Y*3 + i] = Math.round(
        255. * Math.max( 0. , Math.min(1., LUTable[Y*3 + i]))
      );
    }
  }
  return LUTable;
}

//前処理１(元画像のメモリを準備する)関数
function filterSrcPrep(theCanvasId, width, height){
  // 処理後画像用キャンバス(非表示)を準備
  var theCanvas = document.getElementById(theCanvasId);
  var theContext = theCanvas.getContext('2d');
  // メモリにキャンバス(非表示)の画像データを入れる
  var theData = theContext.getImageData(0, 0, width, height);
  return theData;
}

//前処理2(処理後画像のメモリを準備する)関数
function filterDstPrep(theCanvasId, width, height){
  // 処理後画像用キャンバス(非表示)を準備
  var theCanvas = document.getElementById(theCanvasId);
  var theContext = theCanvas.getContext('2d');
  theCanvas.width = width;
  theCanvas.height = height;          
  //処理後画像用メモリを準備
  var theData = theContext.createImageData(width, height);
  theData = theContext.getImageData(0, 0, width, height);
  return theData;
}

//後処理(処理後画像を描画する)関数
function drawCanvasImg(theCanvasId, theData){
  // 処理後画像をキャンバス(非表示)に描画
  var theCanvas = document.getElementById(theCanvasId);
  var theContext = theCanvas.getContext('2d');  
  theContext.putImageData(theData, 0, 0);

  // srcのときの描画処理
  if(theCanvasId == "srcCanvas"){
    var dataSrcUrl = theCanvas.toDataURL(); // 元画像のbase64データ(URL)をキャンバス(非表示)から取得
    var srcImgDoc = document.getElementById("srcImg"); // 元画像用のimg要素にbase64データ(URL)データを入れて画像を表示
    srcImgDoc.src = dataSrcUrl;
    srcImgDoc.style.visibility='visible';
  }
  // dstのとき描画・保存処理
  if(theCanvasId == "dstCanvas"){
    // dstファイルの表示とダウンロード用の保存処理
    // 処理後画像のbase64データ(URL)をキャンバス(非表示)から取得
    var dataDstUrl = theCanvas.toDataURL();
    // 処理後画像用のimg要素にbase64データ(URL)データを入れて画像を表示
    var dstImgDoc = document.getElementById("dstImg");
    dstImgDoc.src = dataDstUrl;
    var srcImgDoc = document.getElementById("srcImg"); 
    dstImgDoc.width = srcImgDoc.width;
    dstImgDoc.height = srcImgDoc.height;
    dstImgDoc.style.visibility='visible';
    //　保存用の画像にデータを保存
    document.getElementById("save").href = dataDstUrl;
    // 保存ファイル名を自動生成
    var selectFile = document.getElementById("selectfile").files[0];
    if (selectFile){
      var selectFileName = selectFile.name.match( /(.+)(\.[^.]+$)/ )[1]; // 拡張子を除くファイル名を抽出
    }else{
      var selectFileName = "sample"
    }
    document.getElementById("save").download = `${selectFileName}_ice.png`;
  }
}


// 合成処理の種類を選択した時の処理
function blendTypeValueChange(){
  console.log("変わりました！")
  interferanceColorFilter();
}

let element = document.getElementById('blend_type');
element.addEventListener('change', blendTypeValueChange);

// 画像合成処理の関数の定義
function blend(){

  // 合成処理の種類の取得
  var blendType = document.getElementById('blend_type').value;

  //メモリの準備をする
  var srcCanvasId = "srcCanvas";
  var dstCanvasId = "dstCanvas";
  var width = document.getElementById(srcCanvasId).width;
  var height = document.getElementById(srcCanvasId).height;
  var srcData = filterSrcPrep(srcCanvasId, width, height );   // srcキャンバスデータをsrcに書き込む
  var dstData = filterSrcPrep(dstCanvasId, width, height );   // dstキャンバスデータをdstに書き込む
  var tmp;

  // 処理後画像用キャンバス(非表示)を準備
  var srcCanvas = document.getElementById(srcCanvasId);
  var srcContext = srcCanvas.getContext('2d');
  // メモリにキャンバス(非表示)の画像データを入れる
  var srcData = srcContext.getImageData(0, 0, width, height);  
  var src = srcData.data;
  var dst = dstData.data;

  //α合成の処理
  // ブレンド率の取得
  var blendRate = Number(document.getElementById("blend_rate").value);
  if ( blendRate < 0 || blendRate == "" || blendRate == 0 ) { // 取得した値が負とか""だったら0にする
    blendRate = 0;
    document.getElementById("blend_rate").value = blendRate;
  }
  if ( (blendRate > 100) || (blendRate == 100) ) { // 取得した値が100超えだったら100にする
    blendRate = 100;
    document.getElementById("blend_rate").value = blendRate;
  }
  var alpha = blendRate / 100. ;

  //ピクセル処理 入力:src 　メモリ：tmp　 出力:dst
  for (var i = 0; i < height; i++) {
    for (var j = 0; j < width; j++) { 
      var idx = (j + i * width) * 4;
      for ( k = 0; k < 3; k++){
        dst[idx + k] = Math.round( alpha * dst[idx + k] + ( 1 - alpha ) * src[idx + k] ); //α合成
      }
    }
  }

  // 各合成処理のピクセル処理
  switch (blendType) {
    case 'multiple': //乗算合成処理
      //ピクセル処理 入力:src 　メモリ：tmp　 出力:dst
      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) { 
          var idx = (j + i * width) * 4;
          for ( k = 0; k < 3; k++){
            dst[idx + k] = Math.round( src[idx + k] * dst[idx + k] / 255 ); //乗算
          }
        }
      }
      break;
      
    case 'pinLight': // ピンライト　(干渉色が合成色)
      var idx;
      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) { 
          idx = (j + i * width) * 4;
          for (var k = 0; k < 3 ; k++){
            if ( dst[idx + k ] > 127 ){  // 合成色が50%グレーより明るいとき
              if ( dst[idx + k ] < src[idx + k ] ){  // 合成色より基本色が明るいピクセルは、
                dst[idx + k ] = src[idx + k  ];  //RGB　変更されない (srcに戻す)
              }
            }else{                              // 合成色が50%グレーより暗いとき
              if( dst[idx + k ] > src[idx + k ] ){  // 合成色より基本色が暗いピクセルは、
                dst[idx + k ] = src[idx + k ];  //RGB　変更されない (srcに戻す)
              }
            }
          }
        }
      }
      
      break;

    case 'blight':  // 比較(明)
      //ピクセル処理 入力:src 　メモリ：tmp　 出力:dst
      var idx;
      var graySrc;
      var grayDst;
      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) { 
          idx = (j + i * width) * 4;
          for (var k = 0; k < 3; k++) { 
            if ( src[idx + k ] > dst[idx + k ] ){  // 明るいピクセルを採用する処理
              dst[idx + k ] = src[idx + k ];  //RGB
            }
          }
        }
      }
      break;

    case 'dark':  // 比較(暗)
      //ピクセル処理 入力:src 　メモリ：tmp　 出力:dst
      var idx;
      var graySrc;
      var grayDst;
      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) { 
          idx = (j + i * width) * 4;
          for (var k = 0; k < 3; k++) { 
            if ( src[idx + k ] < dst[idx + k ] ){  // 暗いピクセルを採用する処理
              dst[idx + k ] = src[idx + k ];  //RGB
            }
          }
        }
      }
      break;

    case 'overlay': // オーバーレイ   ★★★★★★★★★★数式がオカシイかも、、要検証
      //ピクセル処理 入力:src 　メモリ：tmp　 出力:dst
      var idx;
      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) { 
          idx = (j + i * width) * 4;
          for (var k = 0; k < 3; k++){
            if ( src[idx + k  ] < 128 ){  // 基本色(原画)の それぞれR,G,Bが 128より暗いとき
            // 結果 = 2 ×（基本色 × 合成色)
            dst[idx + k ] = Math.round(2 * src[idx + k ] * dst[idx + k] / 255 );  // RGB 処理
            }else{  // それ以外
            // 基本色＞0.5
            // 結果色＝2*（基本色+合成色-基本色*合成色/255）-255
            dst[idx + k ] = Math.round(2 * ( src[idx + k ] + dst[idx + k ] - dst[idx + k ] * dst[idx + k ]/ 255) -255); // RGB 処理
            }
          }
          dst[idx + 3 ] = src[idx + 3 ]; //Aは原画のまま
        }
      }
      break;

    case 'standard':        // 通常合成　の場合　⇒とくに何もしない
      break;
  }
  //////// 処理内容はここまで

  //画像処理結果を描画する
  drawCanvasImg(dstCanvasId, dstData, width, height );
}

// 干渉色画像変換処理関数
function interferanceColorFilter(){
//メモリの準備をする
var srcCanvasId = "srcCanvas";
var dstCanvasId = "dstCanvas";
var width = document.getElementById(srcCanvasId).width;
var height = document.getElementById(srcCanvasId).height;
var srcData = filterSrcPrep(srcCanvasId, width, height );   // srcキャンバスデータをsrcに書き込む
var dstData = filterDstPrep(dstCanvasId, width, height );   // dstは新たにdscCanvasの内容(空っぽ)を入れる
var src = srcData.data;
var dst = dstData.data;

/////// ここから下が干渉色処理 入力:src, 出力:dst　///////
//各入力値を取得
let repeatTimes = Number(document.getElementById( "repeatTimes" ).value);
let phaseRate = Number(document.getElementById( "phaseRate" ).value);
let phase = Math.round( 256./100. * phaseRate )

//干渉色変換のルックアップテーブル生成
let LUTable;
LUTable = makeLUTable(repeatTimes, phaseRate);        

// ピクセル処理
for (var i = 0; i < height; i++) {
  for (var j = 0; j < width; j++) {
    var idx = (j + i * width) * 4;
    var gray = Math.round (
      0.299*src[idx] + 0.587*src[idx + 1] + 0.114*src[idx + 2]
    );
    dst[idx] = LUTable[ ( gray ) % 255 * 3 ];         //R
    dst[idx + 1] = LUTable[ ( gray ) % 255 * 3 + 1 ]; //G
    dst[idx + 2] = LUTable[ ( gray ) % 255 * 3 + 2 ]; //B
    dst[idx + 3] = src[idx + 3];                      //A
  }
}
//////// 干渉色処理はここまで　///////
drawCanvasImg(dstCanvasId, dstData);

// 画像合成処理
let blendRate = Number(document.getElementById("blend_rate").value);
blend();
}

function negativeImage(){
//メモリの準備をする
var srcCanvasId = "srcCanvas";
var width = document.getElementById(srcCanvasId).width;
var height = document.getElementById(srcCanvasId).height;
var srcData = filterSrcPrep(srcCanvasId, width, height );  // srcはsrcCanvasの内容を入れる
var src = srcData.data;
/////// ここから下に画像処理内容を記述 入力:src, 出力:src　///////
for (var i = 0; i < height; i++) {
  for (var j = 0; j < width; j++) {
    for(var k = 0; k < 3; k++){
      var idx = (j + i * width) * 4 + k;
      src[idx] = 255 - src[idx]; // RGB
                                  // Aチャンネルはsrcのまま
    }
  }
}
//////// 画像処理内容はここまで　///////
//画像処理結果を描画する
drawCanvasImg(srcCanvasId, srcData);   // srcCanvasに書き込む
interferanceColorFilter();
}

// ★★テンプレート★★ 〇〇画像処理関数の定義
function templateFilter(){
//メモリの準備をする
var srcCanvasId = "srcCanvas";
var dstCanvasId = "dstCanvas";
var width = document.getElementById(srcCanvasId).width;
var height = document.getElementById(srcCanvasId).height;
var srcData = filterSrcPrep(srcCanvasId, width, height );  // srcはsrcCanvasの内容を入れる
var dstData = filterDstPrep(dstCanvasId, width, height );  // dstは新たにdscCanvasの内容(空っぽ)を入れる
var src = srcData.data;
var dst = dstData.data;
/////// ここから下に画像処理内容を記述 入力:src, 出力:dst　///////
for (var i = 0; i < height; i++) {
  for (var j = 0; j < width; j++) {
    //RGBAの処理が異なるとき
    var idx = (j + i * width) * 4;              
    dst[idx    ] = 255 ;//処理を書く;         //R
    dst[idx + 1] = 255 ;//処理を書く;         //G
    dst[idx + 2] = 255 ;//処理を書く;         //B
    dst[idx + 3] = 255 ;//処理を書く;         //A 255は不透明、0は透明
    // RGBAの処理が同じとき
    // for(var k = 0; k < 4; k++){
    //   var idx = (j + i * width) * 4 + k;
    //   dst[idx] = 255 処理を書く;         //RGBA共通の処理
    // }
  }
}
//////// 画像処理内容はここまで　///////
//画像処理結果を描画する
//drawCanvasImg(srcCanvasId, srcData);   // srcCanvasに書き込むとき
drawCanvasImg(dstCanvasId, dstData);   // dstCanvasに書き込む
}

function alignVertical(){
  document.getElementById("newLine").innerHTML = "<br>";
}

function alignHorizontal(){
  document.getElementById("newLine").innerHTML = "";
}

function swap(){
  var srcImgDoc = document.getElementById("srcImg")
  var dstImgDoc = document.getElementById("dstImg")
      dataSrcUrl = srcImgDoc.src;
      dataDstUrl = dstImgDoc.src;
      srcImgDoc.src = dataDstUrl;
      dstImgDoc.src = dataSrcUrl;
      srcImgDoc.id = "dstImg";
      dstImgDoc.id = "srcImg";
}

function changeSize(dispRatio){
  var srcImgDoc = document.getElementById("srcImg");
  var dstImgDoc = document.getElementById("dstImg");
  var dispWidth = srcImgDoc.width; 
  var dispHeight = srcImgDoc.height;
  if ( ( dispRatio < 1 ) && ( ( dispWidth < 200 ) && ( dispHeight < 200 ) ) ) { return; }
  srcImgDoc.width  *= dispRatio;
  srcImgDoc.height *= dispRatio;
  dstImgDoc.width  *= dispRatio;
  dstImgDoc.height *= dispRatio;
  return;
}

function fileReset(){
  document.getElementById("selectfile").value = "";
  document.getElementById("srcImg").style.visibility='hidden';
  document.getElementById("dstImg").style.visibility='hidden';
  document.getElementById("save").href = "";
  var srcCanvas = document.getElementById("srcCanvas")
  var srcContext = srcCanvas.getContext('2d');
  var width = srcCanvas.width
  var height = srcCanvas.height
  var dstCanvas = document.getElementById("dstCanvas");
  var dstContext = dstCanvas.getContext('2d');
  srcContext.clearRect(0, 0, width, height);
  dstContext.clearRect(0, 0, width, height);        
  }

  function fineRepeatTimesStep(){
  var valueStep = 0.1;
  if (document.getElementById("fineCheckBox1").checked) {
    var valueStep = 0.01; 
  }
  document.getElementById("repeatTimes").step = valueStep;
  document.getElementById("repeatTimesSlider").step = valueStep;
}

function finePhaseRateStep(){
  var valueStep = 1;
  if (document.getElementById("fineCheckBox2").checked) {
    var valueStep = 0.1; 
  }
  document.getElementById("phaseRate").step = valueStep;
  document.getElementById("phaseRateSlider").step = valueStep;
}




//HTML読込完了したら行う処理
window.addEventListener("DOMContentLoaded", function(){
  // ■■■■■■■■ファイル選択時の処理■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  var img = null;
  img = new Image();
  //■ファイルのロード完了時の処理■
  img.onload = function(){
    //■画像の読込完了時の処理■
    var originalWidth = img.width;
    var originalHeight = img.height;
    var width = originalWidth;
    var height = originalHeight;

    var imgShrinkPix = 1280;
    if (document.getElementById("imgShrink").checked) {
      if ( originalWidth > imgShrinkPix || originalHeight > imgShrinkPix){
        var imgRatio =  imgShrinkPix / Math.max(originalWidth, originalHeight);
        width = Math.round(imgRatio * width);
        height = Math.round(imgRatio * height);
      }
    }
    var srcCanvas = document.getElementById("srcCanvas");
    var srcContext = srcCanvas.getContext('2d');

    var dispRatio = 0.5 / Math.floor( Math.max(512, Math.max(width, height)) / 512 );
    var dispWidth = Math.round(dispRatio * width);
    var dispHeight = Math.round(dispRatio * height);
    srcCanvas.width = width;
    srcCanvas.height = height;
    // 元画像の描画
    srcContext.drawImage(img, 0, 0, originalWidth, originalHeight, 0, 0, width, height);  // 元画像をキャンバス(非表示)に描画
    var dataSrcUrl = srcCanvas.toDataURL(); // 元画像のbase64データ(URL)をキャンバス(非表示)から取得
    var srcImgDoc = document.getElementById("srcImg"); // 元画像用のimg要素にbase64データ(URL)データを入れて画像を表示
    srcImgDoc.src = dataSrcUrl;
    srcImgDoc.width = dispWidth;
    srcImgDoc.height = dispHeight;
    if (document.getElementById("negativeCheckBox1").checked){   //ネガが[チェック]のとき
      negativeImage()
    }else{                                                       //それ以外
      srcImgDoc.style.visibility='visible';
      interferanceColorFilter();//　干渉色処理と処理画像の描画
    }
  };
  img.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAFoAPADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD5fS9uiebmf/v4atR3dwetxN/32azY+tW4qANGK4nPWaT/AL6NWo5pT1kf/vo1nxVcioAvRSOert+dWYyT1JqnFVyKgC3GAeoFWY40PVV/Kq0XarcXagCzHDEesaf98irUVvAesMf/AHyKgiq3FQBNHaW5628P/fAq1FZWp620H/fsVHFVuKgB0dhZnraW/wD37X/Crcem2J62Vt/36X/Ckiq3F2oASPS9PPWxtf8Avyv+FW49I009dPs/+/K/4UsXarkVAEcWjaWeum2X/fhf8Ktx6JpR66ZY/wDgOn+FSRVcioAhi0HSD10qw/8AAdP8Ksx+H9GPXSNO/wDAZP8ACrEVXIqAK0Xh3RD10fTf/AVP8Ksx+GtCPXRdM/8AAWP/AAq3FVuKgCpH4Y0A9dD0v/wEj/wqzF4V8PHroWlf+Acf+FXoqtxUAUY/Cfhw9dA0j/wDj/8AiatReEfDZ6+HtH/8Aov/AImtCKrcVAGbH4O8Mnr4d0b/AMAYv/iatxeDPC56+G9F/wDAGL/4mtOKrcVAGVH4K8Knr4Z0P/wAi/8AiazPHXg7wzbeBPEdxbeHdGhni025kjkjsYlZGETEMCFyCDzmuzirJ+If/JPPFH/YKuv/AES1AH5rR9atxVHHZ3QP/HtN/wB+zVuO1uB1gl/74NAEkVXIqgit5h1hkH/ATVqOGQdY3/75NAFiKrkVVoo3HVW/KrMYI6g0AW4u1W4u1VIyB1IqzHIg6uv50AXoqtxVRjmiHWRP++hVqK4hHWaMf8CFAGhFVuKs2O7th1uIf++xVuK9tR1uYP8Av4KANOKrcXasqO/sx1u7f/v4v+NW49SsR1vLb/v6v+NAGrF2q5FWPHqmnjrfWv8A3+X/ABq3Hq2mjrqFp/3+X/GgDYiq5FWJFrOmDrqNl/3/AF/xq3HrelDrqdj/AOBCf40AbcVXIqwote0gddVsP/AhP8atR+INGHXVtP8A/AlP8aAN6KrcVYEXiLRB11jTf/ApP8asx+JNCHXWtM/8Co/8aAOiiq3FXOx+J9AHXW9L/wDAuP8Axq1H4p8PjrrulD/t8j/xoA6SKrcVc1H4r8O/9B/Sf/AyP/GrUXi7w2OviHR//A2P/wCKoA6eKrcVcvH4w8Mjr4i0b/wOi/8AiqtReM/C4xnxJov/AIHRf/FUAdTFWT8Q/wDknnij/sFXX/olqrR+NfCw6+JdE/8AA+L/AOKrL8deMPDNz4E8R29t4i0aaeXTblI4476JmdjEwAADZJJ7UAfFZuEBwQ2fpTvPX+635VEEIP41OI8r7io5mXyoaJlPY/iKBKp9R+FKsJI6VDLGUBPSjmYcqLCsG6U4jGM1Xt3CjLHiq9/fqoIjOTS5mNQTLU1xHD984qodXts4xIf+A1iyyvMTuYmm7cDPeqTfUrkTNz+1rf0k/wC+f/r0h1i2BwfM/wC+awSajyM896dwcEjo01a3Y4Ak/wC+aU6rADjEv/fIrnGPlkFTUguAEIIJY0CtDqbja1bL1Ev/AHyKZ/btp6S/98j/ABrFhtZ7lv3cbNn0FaMfhu8ZNzJtHpRzIlxvsWf7dtP7sv8A3yP8aP7dtP7s3/fI/wAaZbeF7ifJPygVesvCJeQiRjgUuZC5GVf7ctPSX/vkf40v9t2n92X/AL5H+NdCvhOwjiJkwT7msLVNJtIlYREA0c6G4Mi/t20/uy/98/8A16Q67aekv/fI/wAa5+aLYxAqIincg6ca3akcCX/vn/69PTV7Vzgbx9VrlQSKcHNBSt1OtOowBsEt+VSR3UT/AHTXIiQ461JFOy9CRS1BpHUTXkUX3g34CoP7XtvST/vkVhNcFuGOaiDYNPUTOiGrW392T/vmlGq256CT/vmueU0bsGgDov7UgxnbJj/dp8WoQSsFQPkkDketYQbcmBT7Qf6VCe4df50FuHY6MDJ6VMibvwoCn8Klh4/GsxkioBTZYlIJYVKxCrnFY+o6jtJVD9TSYyhqUvlEop/Ks5A0h+UGpiDcy89D3qe4lS3XZEAT61S0KREI4oosvy/pVKST8KcokupgkQLOxxgV9BfCH4G/ao4tW8VREqcNHaN0+r/4UDvfY8N0rwxrGrRefa2Un2YnHnMML+B71sXHgmS0i3XMuW6HtX078S7/AE7w7oBt7CKIzcRxqAAF+grw2Vp75vNumLAdAe1Q59EN00t9zk7DwzEybpjn61ox+GbTIO0cVrhdzcHCj0phvEizkihSZPKia00+2s4hsRQfpVgvEBliAPSsG81fAIU1i3OpTScb8D2o5QudRc3sUSkIQM1R/tuO3DdSfauZMjHJZiaikfJ46mmokuRpXOt3EzsQAFPb0rIuriSViWNSTEJHgH5jVbB/iNNJCbuQtHuzmq7xYzV0iopOlWQUWXHWmVYdahcYpisNzQPrSUA0xDwxqZBkVXqe3lVWG7pSYCn5e3NMJPrWvFY/aot0fUVRubZ4GKuDkUkx2EibgZPFWbQ/6ZDg9XX+dU4R84znHerlsuLyH/fUj86o0TujtUjDKOO1MdNgz0FSRvwBUd5cRxwsXIz2FYjSKN9fKibVPNYDBrqXvtzzU8h+1TFYxyTzTp/9FgxxuNOwyncsIcIh6dTUEMb3U6xxglmOOPWlhjlup0jhRnlc7VVRkkntX1H8DfgyNPEGs+Iow15w0UDciL3Pq38qoWrG/A34RLaQwavr0ANx96KJ1/1fuf8Aa/lXq3jfxTa+HdOMUeDIRhVBrb8R6lDoejyyLgBFOB618teO9fn1C5Z5ZCXdvXge1ZSb+FGsbJcxU1vVptZv2muHzGrEgViXN+uCqnCjisu9vTHHsQ4981Tj8+6G1FYn1Hf60KNiZTuXJr5vmCNj3qi8jMxJOake2khGZkYY9qrySRspCkZHpVpIzuyG4Oe9VgvNSSNn6UL7VQrkZXI6UwqFye4q0V4zUbrkUxFM5ZtzdKa2T0qZlH5VE3bBpAhhFRsARUxHyk96iYYNCEQMuTUboKsyBUGOrd/Qe1RcseBQBUKUwirskRVenJ61VZfyqkJjKdwKaaUGmIuWV7LayAoePSukgEOqRDJG/FcknJxWlpk7W1yhHrzUyXVDTG3UJguGjI5U1NZnN5FvBxuGCPrV7X41YxTqfvjnFULR8XEA6jeo/WnEtaHZN8kQfjAFc9qMxlc4PXgVdvbpxF5Y4B6moNJtFupWkk4CngVmadAsrYwQ7/4iKx9RnMsvXpXT6tItvbkH04rB8N6XJr3iKx06EfNczKnHYE8/pmiImfQ37NXwzia1h8S6tEHmlGbZGHCL/e+p/lX0Vq95FpWnPJkKqLUXhjTotL0W1tYV2xxxqqgdgBXm3x2177HpsVqkm1pWyfoP8ilKVkXFJyt0RzfxK8bR3GlywI4M0hwF3ZP4V47c6feXMZnWNnDDOPT2qurjUbkspO4H723pXoETG3s7cEZbYCT6ms2mi78/oeeaP4bnvL3/AElSFB6GvS9M8NWtvEoMYJxTYZ8uDsAYHr0ro9NuUn2q+A/86LsPZoxrvwxa3SbWjrnrv4aQyPvhypBz8vFes29qCMkVZWONeDiqQOCPAL/4a38RJtnBX0IrGn8Gaxbcm33Y/u19LyNEM8A/hmqcxibrAT/wA01JkOmj5r/4RzVc4+xvTX8OaqoybR6+jxHBnm3I+qGlMVo/ylFz6UcwvZHzFPoWpL1tJfwFUZtMu4s+ZbyLgZ5FfVo0y0k/5Zqar3Ph2zmBBhX8qfOHsj5Re3m8sfun5JP3TT49Puyo2W8rSt0+U/KP8a+n28KWIIPkL+VD6LY2yljCu76UOdkHsWz5tsfCeq3dwka2jDd0zXW2/wANvLQG7nBYclV9a9ZMR3MtsgVjwzYqpPZMnLtknqScCpcnIuNJR3PH9V8GSrlom+QfdPpXFahp7Wcxjk5IPUdDX0NqUax2LFwAAK8b8QzWk00q7ed2AcYz9OaqLMakbHFsBnim4NTSoFdtmSB600HitbmIsBAkXPTNXpRhwy9KojnkVqRo0tsrY4Hekxli6fzdNRjnKmqthzPD/vj+dW2ZBpzoeueKqaecTxD/AG1/nREpGtqDZkIHXoK1rBRb2yZAyeaykXzLlcjJBzW1dri0LDjAqGjQxvEsvmFQp+UcmvQf2YNA/tLxwb2RN0dnGWBx/E3A/TNeVX0srkZHynpX1d+ynoYtPCkuoOuHupSwOP4RwP61UY3QpSSZ7hdyLbWbMSAFFfHnxV8TTa74mugHzDCxijAPGAetfR/xg1Z9O8MzJDII5px5asTjGe9fK/8AYDXVy22/tiWPIB3Gol8RafuabsXQ99rCrHapfkALkj6n1ru5XYrDtQnKA9Kw9O8OyW6iKJo9jdZD94e+DxXWrYnbEplKhVxxUS12NaXmUI1YkGQKo9O/5VoQIUIK5H14q3b2kMXRWZvUCptsSceXg+5pGlr7GjpuosjKlwWMfdh1H+Ndloo0Sa1eXz1eVAWKuecD2rgTGGj3JwwqOYFwGXhz1waxlUcXoWqakj0ex17RP7SEDKqwsMCQjgGtk6x4eFtLKk8B2fwjqa8cRg6YXtwaqtLskGOvc1l9alFFPDRl1PVJ/F2ghRmJs57rWfqmveGZowBHvc9cL0FcBeLmMOOQOM1XRN7jn7opfWpD+rROpur/AEiKVvsV1IVB4XGc07T9Ygmcq52f71cT5e25fb90HGavIAqDd1PApKvJu5TopaHYT6lAdywDeR/F2FZUx3kvK4C96q25KosYx6kCnzncwUAHFbQm5aszcUtEV57wDKQofx6n6+lVJllmGXjH0rUjkgQ7WK+Z3VRk0k9x+7Jji+hYf0ra9+orW6HH+LBKumNHDE7MRjA6mvHL3RHiRpL147QE9JCNx/4CCa9f8ZXFyIRsPH93OM15Hr8wjldbx4OvyiMZYfX1rSBxVVqc5dC0jG2B3lI6swwPwFUcip55lYkBf+BEYquRk9a2RgyRSBW9pp83T2UDoa54Ct7w8w+zXKt2GRUyBFS8badgP1o0/wD4+Yv99f51XmyZTnrU+ng/aYv99f500ho6DT15aTvmtS8bfpj/AErPs4iI3x2NT3EjLpsnpzUopnOTOZniiQc5Civvr4X6SujeDNNtVQKUhUH645r4V8B2n9p+NdHtSMiW6jB+m7P9K/Q6wQQ2ESLwAtaRdlYiSbZ4x+0NfBbeytRyzOW/AD/69fPkieZPgRSsB/dUmvXPjxfG58UxwoeII+fqTXkWqvKkRZpGAPbNZt3ZolZHR+E4A+pLsmdTHxs8w9/UV393EFMZ3EYGOK4v4T6fvhFwVALnJOOTXp2r2u20STGMHk1jM6qOxjRhejlsfXFTNDIiF7eZ3XqV64qNWVR84GPakfCkNC+D7HrXO5WOxRJbS7yCrEHtkdqHcuwQHrnaajK+Yxd1Af19aswW8kgBRc1jOV9hpWH+WIYN5GMg5/Gq9lbLevLxjBwfat2K0a5sJIpAd+MAkVW8N2xT7TuBDBuQaiUNV5lKWjMm3X9zPG+fkYgZpqfIkzAfMowP1robfSw8RZhhmYsf50s2k7dzEEElse9SqUuW5XtFexzMdr5GledIDyd2fxq1bxG5iaSMHK8KPetS/hVtDMS8OqhenpU+k2Ij0hQRhnGTV04psiUrK7OaSVoJTubO3v705Wa4bbu2qT8xz+lad5o/Vo8sx7nt9KyGRrZyDndnpVRbg7MTs9jUjjgtowqDbkdFHJpZXVI/nAUH+HOSaxjqBjcKo3SnjJ7UbnOZHJdj3rpi7mUlZHB+PdcaOaRFt0WLO3nkt9DmvK9QurV5Tts0Q/jz+tdF8Qp5bnW33NtEZO1R0X3+tcfqBP2gs2MsAcDtxXVCJ5tSWpDM6E/LGo+mahzTvrSYrQyAHitLRZMTuhPDris4CnwSGGdJFOCpoYF2aPbIQRyDipbL/j6i/wB8fzqS+AYrIvRxmo7L/j7i7fMP50IZ1FkBt4PXrUOovjT5V9qfb/IoPaqOtygwEKetZrc16mp8E4/O+J2hADOJt35Ka+8rq5S004ySEKqpkk18GfBK9hsPiXpEtwwVN7Lk+pUgV9cfErWAPDMqwNyyc7T2py0CCueIeOr1dU8Q3l4jZjZsD6DivP8AxJcIYhED8zDHFdlq8H+ioyE5PBrltW8MXHF2JWIVgXXsRkUWYmz1b4a2ixaTb4H8AruNRiEliymue8DwhNMjwB04FdHfPttmAOM1hPa7OymnocdqEUiNtUcVDaWsqjc7cdxV6+nAbnrVdZ5n+VAOelcdSa6HZFNo0bXywoL5IqlrPi+00lvLjtzJJjgYxn9M1d0jSHuJ9807Fe6CvOviFZzWd7fKisryJ+6bvgDkD8f51VNSerM6rUfM6LTviektwVeGHaOqkkEfj0H416Jo1zZ6tY/bNOYEvyynqD6GvmjQLG0E3mRNOzqqESbhs5Hzoy9cj19q9H+HlzLp2tj7MzLBNII3TqMYyT+FdDp8r5W7o54VXNXtZnsmlwZj2MOR61PqESrESw5HenRuFfcv44qpq14yJuZMxjr7Vq48tNkqTlMzljittPmuLx1WBfmZm6AeteU+LPie1vIBp+5IP4Nqgkj1JP8AQV1vxRuDe+HYYLNwyvICyA8uBztryfWrWIwrILdHuFKbS8ZbagJLDbxnPH5GsKcIXUb6GlWpOMeZLU63QPHN3eLE0wSSKQ4B6c+mR0NdXPPBcKDkIxHRjzXlPg/TZmLRiLymuJSUhT+FS2fyAr2rVtLthZxNMgE4X+E1jUi1flZrSnzJcy1OYnsFZ98bgY9KlQCO3IPUVBeLJbfNCSy+lRJMXXDcE9amnV5dC5wvseS+PI44ry6nuFIZj8qdia88lcuxZupNeu/EjS2nQ3KEEKORXksoAfkDGe1elSs4nk1VaRBSClIoHFamQuaQGlFFAGzp0TXGnSdzGeKjsx/pcQP98fzq94VZdkyN0NV0AGogDoJB/OpW4za35hwKzb8h4znrV+PLR/jWdfArn0qTXqZmnXD2WoQ3EZw8Thgfxr3hvGU+raAkRQjeuHOc14DOP3ma9H8B3Kz2Aic/MvFPlUmS247HR2he6QiRiQPU0uuaiUsvJLc8LjFOSPyGJXjNYniZWkjDRE5HNazjbYzhK+h7X4JO7SYMkfdHPrV3WZgoxnoKwfhtcibR4Qx521q+IF/e4B6ivOrydj1aKuY6oZ5M9RnvWjBbFOVFNsbQoA24YPbrWzBHEF56/WueFO61NpzsYxmubSbzIyeO2OKXVGsdagCalbAsDwyNg1qXVurg7QPzrNisZZbgKpAUdyKzblTdomiUZq7M/TvDugWkjPHp0s0h5zK2R+VOj0+Aaqk1vbKjbs7YxgfjXRRwLDHsYgkD+EVsaRYIFDvHt78jBq6aqVnYiXJSV0ixE6wxRoSAcfnUF/PF9ml83hMYJrO8RadqeyaXS7xY3IyvmRb9v8qztTF7qlslpZXAgld03ybN3yjlgB716U6jS5bGNKhGS57mDf6W16hMWHTduQg+n+NXrKITWnkXNvBOF7TJmuq0fw8LC1YPK88jHJLcAfQCqN4I4J8qnO7BA4NeZUpTpe89DoVSFRuK1Ofj8jTZC9nYW0EnTdHHUUlxLdyFpHZj3yeldBfWsV3CTzuxnrWdDZiP76EAHuayfM7XehS5UtCqbfMfHPtWPfxOjngr+FdlH5ezgqBWLrtsrxFkIJrf2asY8zuedeLSW02YM4XjrXil6QZnywYdiK9q8TwNPZyxmTZ74614rqMTRXLqSG56iuzD7Hn4ncqEU2n0oFdZyiYOKQKScVIOBzUsS9W7CkBbs7hrO1YIv7xu/pUdkZWvIi2eZFJ/Olh/eI3tVq12ieHH94fzoGjXtTkOM9Kq3yjH0qez4lI7GmXi5yKg0ZhTqOtb/g29W0v1jLYD1hTg7mBqCB5I50dDyhzycVUXYc7NHuwjE0W4dxmsLUxtco3FbnhWRb3SY23AtgdDml1bTSzqUj3E8c81pVacTKnF3Nb4YXe0NAMkKetdxrSxsysWxiuQ8FaeLW43yOHYLwB2+gHAroL2R2clFUD1bn+deZWl0PUoqyJInwmIgzf7q1LGk8j5bYn+84z+VVoFMqhpWZl/vOdq/l3rStmiQ4jBJ9FUD/69c/LzO7Oi9loXLOHaPnZWPspP9K0Uj3DC8f8AAaqQNlgcov1+Y1pRcgMGyPUjiu6EYtWOScmmS21nFH82C7nuRipw4XjIHsKi88YxljVW7n8tGY4AHpXRFKK0MZXk9RdQvCiHYcVi6Tdot9N5fDZHOKY4nvmJ/wBXF7jk1Jb6eG243KV6EGod27nVC0YtdzqoZvMjwRn6Vn3EWXxhHJOSJBUNsbi2YJLiSM9H6H8atyOdpJwfY06i5o6nPH3JaFGW2VeUjCH26VVmR1H7yI49R0rQ3L1YYXvz0qKRFJ/cyFfYHIrFQ0NHLUyLm3DpuQD6EH+lZU6qFZGyPxB/nXTNux8yo49QOaydThilRs7lb8/0rH2et0a891ZnlPjGzYxSLDI3fjof1rx3VLbbcMvIcdQ4wa+gdXsJZEkClZU6Y6/oa8k8Q6W6XjpIhVQeATwPoeo/UVtSdjkrxvscNIu3rxTAav39rJbyYY5U9Dj/ADzVLa3cV0pnI0ABYgDrU0h2oEH40sChRvYcdqiJ3E+ppoRYtGxvX1qxan/Sof8AfH8xVSEEZOOgqzZHNzF/vr/MU7DRrq4EmR2NXLwo8KEL81Z+0vetCv8AFyK0oULQlJPvLxWZs4u1znL3l6pSRkDIrZ1K1ZSSoyKpW6ksEODn1pgtdDrfh1r8tq32eU/u1xyf5V64J4bu2wCPmHQV4PaMYJ1KAeUnOB1P/wCuvTvCMslzGsiklB1Hr7UubSwRi0zv/DUYiVkxkmtv7PvPRSfpnH0rL0uN41MhfZkdBWtaSOX27ufQ/wBa5klc7LtIkisUc7pMse5J/rVqK1XpGg29z0FSwyxltu4M3t2rQWPcMrk+xqlRixe1aK0VpGoBILn/AMd/KpgjZ5JJ7VehiIXLYB9KZIAX245q+Xl2I5uYptvA61CUL/fORV6SM4waqupFUmIRI1HC1biHzVUTIOTU0bHPSrTEXAqlOeRVdoSW4P0qWLJFWI48mh6k7FIWzdR1qnd27xHeD+AroQFXuKiuI1eMsoU4o9ncSqNM5z7SpB3HDev+I71TvAJF+fAJ6Hsfoe1LqMbG5BjJT2qN5PLQoSAD/C3QH/CslCzszVy0ujndVZUYqQ28e3zD/EVxHiG2WdCzAMD0OMj8v/1V1uuzxtlX6r6feX/PpXK3dyclZMEH+Idx61FR8oRXNueeahpmN27Hl545yv59QfrXO3lvh9m3bjrXf6zGyhmX0znsRXC6ldJtKBe/IB4H09Pp0q6b5jnqKxmXDA4VcbRUIHNSSJxuU7k9fT60xB81dKOcl80JGUA5NWdPGbiI/wC2v86q+VvNXLFHW5iB6bx/OkNM1NYtmheO5jJGe4PQ1Lp8+8qeeRzWrMom06SPZuJHHsa5m1Z7e4McgxzUWNk9DXu1555FZNxH5eWT8a3E2zR5HWsueB95Cg49MUrgtGU0aR8FRk+nTJr0fwFPcxXKRyrgEbiD/D6D8v51xthakSLkBQOp6kV1/hzEd4GRWwxyPUn1NZSkjaK6nrkL71ABwcVZjVkXbDhc9Tk5Nc5a3bKAFIB9TWpDqM6r0jYD14rBtLVnSrs2oIFHBAbPJwSM1tWt01uoAgO31V8/zrkDqrqc+Vz/ALBzWvp2pF8Zkj5/hbK04VddxShpqdZbXSTD5Q2e4HNSSEIudp/GsyB1ZciNB7g8fpUggV23ySE9wAcCulSbRhZJjpJR1XPuD61FncM5/A06dSWLjGTwRRjOCBxS6j6DV5OKerBTg0hU9RTdpY5NVqSWlkXpnmrtiQ0ZJIIzgEVmxwBuWJFW7dDb/Kv3D296a8xMtzRbxyM+hFMUCEc8A+ppsgkK/u5Cp9CMiqk8bupEko9wFxWl7EWKGpNDlo32/wBRXI6veJ5bRq/71RlQ3GR6ZrqL2OJs5G49MkVyWu2RdGK9cH+VZVJM0ijhfEU7mQT4ZS3B+o96yI7oTIyN98fMo/mKt63JJDasrZBVs5z7/wD164y61ZbfLsvzL0YcVg43Yc1i3rmpR+U1uD87g7T6H/CuBmB3nd97POa1NSm824M6nh+QD/CfSql0BL+8H3iMn/Psa6KcOVWOapPmZRDMrZU49akSMOf3fDf3fX6U0r9KBnI61qZliMEirNmJBdRZBI3D+dRxtuxxl/X1q5E4WWJB1LjJ/GnYaR0TShOVPPcVmahEszCXaAfarrj5OeT6VVYHGOazRY/TowGJDdeoNTzbS3PGPTvVSNjHJuHIqdMeYVY4U/dPtUPQtK5PaxbwTu4/lXTaEBG+TjgflXOwjylGwDk9RW9phJHfNYSZvA6y1lGRnbmtq1KEAsfwri4ZSknLNn0rbsrtjjBz79qiVtzWLOst443xuUn8avR2iY4QAewrFsrnoc81pw3DsQBKAfZc1lojVXNKCAoP3U8iewNSqJ92ZZ3lQdtoGPyqsJo0A8+RufXjNWkjtpxuiYhvUHBpc/ZlcpchlXA+bP8AMVOXAGd3FZDRtCcq5YZ53DBFaVufMjGfyrenVvo9zKdO2qJ0fIBPSnquG+U8dxTI152kYqxGgGf0roWpgySJCVy3Q06RHZeGBA9R/Wg5RAM02e48uLAwOO9VdLcSTexVkjkPHnSD2DVRkt5Fb/j6uCewZs1c3naWdt30NQtOBnbG2fesW09TVJmddW0rLhp3I96wdQhlgVts5PH3Sc1u3t2VzwPoDXHeIrrfC+C34MM004kyucT4puA0MqjByMenO7/61eT6mJGnYLu4PTNd1rl5DeiaF2JYsBuHUEDjP51xmoJLGwVwHUj5XUc/StYrqck5XKCMWR1fqMMB+n+FCn93x1U5/PrSRkAsCc5UjNJGQHx2YYrRGbGyJjpnaelIkZcgDJNTxrvyDwPX0pwO07U4H971qrBbqwx5IIX5n7nsKmsWMlxGDydwJ/Oo1UscDrVq3AjlRR98sAT+PSnYLmxI5zjd271CSTy3509yMAsxOarsST8mAKyKJR09akSRUGZMNj+H/wCvVcEjjP1oY4PGCKllpmvE4LDHIPTB7V0mnBVjB5P44rjNPmkCgnBiJ5z2ro7STMY2Et9awkjaLNOV2Mgx09q2NPHALt+ZzXOLvLLkN+Fb1irtgZYj0zWb2NVub0LQsQBIob2NbVoA6KGfJHbOayLW1jIG6PJ9cc1q2sUMZygw1c0pHTFGsUjeHb830ParESReQQsAjdeMx8VQW6ZBghiB3xVlrgtH+7b3rJWNtS3EzOqRSKScdSKuaeGClJDlh3rNgvYlRN4IZuM/56Vft5AXZwcKQAK6KSV0zGpsaKsC208kjNTxIwXc5+gFUo5gxyDgA9aZeaisKBIvmf68D3NdnPFas5eVt2Rcu7ggbQQnqx7VnkwzjPmPKvck8Gs550llDSyoxz16/gBSxmVWYhCRnhtwGR9K5ZVnJ7HTGkootS3kcQMVsjHH8IHA/GqU32mQ7pZvLX+6hz+tIxu5GIMaKg5GXyaVo3A/eOo9lU/zNF5MHZFG5ZkB273HqWzXHeKLpltZGaJsAclRk/lXZXUiAEZBNcd4mEbQyERxlsdc4P6VrBGNTY8i1W/iutxfcGBOGK4P+frXOTSzKhUv5qdeuR/9atrWflmdZLWSM56hyQfzrGMe776yKvqwxXZHY8+W5DFiQkinhUjAL8t6CnFWiB2lSPXIzUJIB69fSqQtiTzC554HoBTlBJAUEk01IGLfL07k1OpVBhDyerf4VaAkwI12g/Mepp0A/fx/7w/nUQI9QKfA4+0RAf3h/Oq0Rm22absMH1796Yx7L1qJi24g1MBuX5W49K5zYai4PPFNkbPI/D1qcRSbdzYAqKSM9Mjj2pDH6awkkeJyRuGc+hrdtXWFtqsje7H+lcvvMDhhnIOfr7Vrx8uH6qeRiomioM6W1uW3gbx+VdNp065Bcr+AxXD2jtvA3HHpXVaSjuqsSwX0BrCTOiKO2sCswBBNbdtEpA7fhXM2czKAqNj3rSWWfAO/P41ztrqjqijcdQE4Oajt4w7EHjFZX2qbGTSxXUnmbhnFJSi+hVn3H6hKbJj56u0LEDI7Z7Uf2ibeRQ3CAZB7VclK3MG1+mM1jX0ZBCEbosfMfWnblegXurM2ZNUiEQdm+XHDA9axGu5pSzNIrSMwIHZRng47nFURDb/akWOZoSp+aPqknr16GrxUrNsjwiRqF3kfy/xqZ3kVCyNHTjIrFW2qM5yTlifetVcbRuYmufgLR48vBYdzUz3sijDsMn3og0tAabNovGPvH8jimmWHPGPzrFR5pTnDBT0qwkDY+bj61rGb6IzlFLqS3ZiIyQAfYVzms28dxayDCtx0YVuSQMASJAPrWDq7t5bA7WGOoGa3j3aOee255BrcCwzSReWwOc4RgOPo1c3dQbWLNEfZiv8AVePzFdP4hLG8kXzoimc7NvA9+R1+lc60Y8zGVJPcDGfy4x711I4pblB4TwQuM+vP6inJF5XMvDkcDrVtY0Vj5PmMfyoML5PUg9dwzV+hFyoXyu0fdHalVSfug1cW2TGT+VShFAOOKqwmyisTtnPANWIINs0ZyeGH86mxxTY2/fx5/vD+dJoCw21s8c00I5I8s8+tOEZzw6n05qdZDEMYBrI0QkccaDJJLDuabI4J+/kelJPImNwbk9qgQ4PQnNAxJ13cqORzVzT5z5WxhuCnjsVH+FV2dQQTuH0qa3ZWcNGvzZwynuPUUgW5uaeA8q/Myg+pFdppqKEVTJj8M1wunXEiTgbVHuVFdrpFxIcFlA/CsJLU3gzrLC2XAy4/Af41pxwKg+V8+xFYtvcscfJ+VaEMzt3I+orBtLodSTZd8tCfSnxwovBx1qKIO5HFWHt5CmV6ii/kVbzHIyAY6CoLlUJLddo4HqanjtXaMjFM+yuiLkEk01qrCe5z9zYBp90coSQndg9CakuS6yLuOMjJA/WtK8twhHy/Maz3jDnY2Sc4B/u+9S4od2OgE0pGHVE/WtSKCMRj5S5HfGazNPtDCxDyGQn3rcsYpJnKFSB2PpSjFJjlK6FRn25XYnYbuTTha+eMyPK5/wBnitu105VUZGW9as+QEGMcCuqNN21OeVRdDl30uIg583/gTVmX2lwBT+8ZPxrtpQu3kAD2rHvYomB4BPvzWqijNts8g8S+GYrqQlZy5J4Ujb+tcjc+HjANquPo7An8K9e1y1MiMFVRjodvFef61BKjMCVK+55rVJWOaW5xdzCbb5GHzZ+marg5OP6Vo3BBJAkyB1UndVJyoYbeKdzMYx9KaBx1qTq3oKGVcnPf3607hYj3YOakh2M68c5FREIMc9OeTRFInnIAc5YfzpXHYjY5PBwc9aXzn24Y/jVQSbnIX1pdxJwazNNiyMu3PNIRgjqKIsDHNSE4PJ5pBcaWfoDTQSGDBtppxOB6+9RscnoaYjd0mQyFH38ZwwJ712umSFVHz5PsK8505jHLhz8h7V3Gl3KlVEYrGehtTZ2FnO2Bgk/Wui0+UOo3KM1xtu5yCWIFdNpkiiMFefeuV6HZHU6SBUI6VZiAz7VlwTkqBmtO3BZfrUKo+hpyF6BBnjpVho1OOBUdtGwAqwVYduK6Kb0uzCS1M+8tY5DyBXN31ntc87eeK6+RN1Z17bhlPrRPUcTC0uHdJjPfkkV11hCqIMDmsLTINs/PQGuotVBxinTCb6FiMcU2WPcOelSEEDio2BzW7n0MFFvUoXMXHFY14uwHJNdJMuV6Vk3tt8pOOam66Fepw+ts3lMRKVHuK891t4xvWba6+pOK9N1pdsTgqMfSvNNdSyk3blKuP4mHGa1iznqLU429W2OTBKox/CaynU5ysi1b1WJom3KFYHutZolI5HeqTMWOaSQ98/jTSZWPOalSZT1AqQSAjimBUMUjdjzUltbOJ4iezA/rVgOcZxToXPmoPVhSGYjkiRsetWIJgRh6gk4kb60ykVsacjgqCh4qISH61VhlKHnkVbBVwGWlYrfYkUjGTTsiogQDTh6gUE6kyAk5zXV6HeDyxtwWHWuSUsR6Vd0+R4JgUyc9RUTV0XHRno2nmW5kAzgD0rr9Pj2hQORXHeHmZkDAda7fS42JBPeuKS1O2m9DZs7Z3cYziuitLTAHFVdMjwBXQWseAM04U1cuU3YW3gwo4qaSL5elTDCio5JK6UrI5222UZY8Cqjxg9a0pMEVSnGKznZGkSokCq+RWlbSBQAKog1LCCW4qFJr4Smu5pl93SnInHPWi3hJAzVtYeK6IRb1ZjKSWiKhQYqjeRfKcVsPDgVRuRwRWqhoZc+pxGs25ZXHSvLPFdm4DnggdBjrXtOrW5dWwK868SWwO4NwfeoSs7Dqaq54hfTT28zbxlTWbPIsnzAY9hXWeILJo5HO0bfWuSnj2sccfStEczIw/OQaljlI65quQQfapF6VSEy15h2gVLASZ4+eNw/nVHLdulT2pJuIuf4x/OmxFRzmRs+pqNhg5p0n+sbHqaaDng1mbbidakjcoaQRntRtIHNMnYtxyCT2NTDK+4rOHy8ipY52VsHkGk0VdPc04nXFXbWRSwGOao2qxyjg81safZrvBY1LHY7DwwWUAEfKe1ek6QvC1wegQINuDXoekp8i1zTVzppM6bTxtANa8coAFYtqcLgVdjJpRfKaPUvmbNMZ6YuMZqKVsVTmJRJi/FQSjdUPne9KJc96zc7l8ltSGT5TUkE4DDJqK4GRmqm4qahScGPl5kdXaShgOa0ImBFcrYXRBGTW9bTggGu+lPmVzjqQ5S9IBiqFwnJq28mR1qrKc10GJmXcWVPFcX4m0j7RGzIvzV30ig5zWZeIpzkDFS43GpHzp4l0+eB33qxWuA1CIrIcDAr6W8U6dBLbu2wZxXg/iuy8i4baCBmos0TJHItkdaZvwelSMcHmm43dBTIDzKmtJQbqEf7a/wA6qspFOs8i8g/66L/OmAxz87fU0IrO6qgLOTgADJJ9qax/eN9TXonwZtLefVb+5lVWnt408rP8O4nLD34Az70imzAtvB/iKWMSLpNztPPzbVP5E5rP1HTrvT5hDqNtLbSkbgsi4yPUeteyeNdd1XQ1gl07SlvLUgmWU7jsOemF5HHOa8q8ZeJB4lu7S4+zfZ3ihMbKH3AncTkH05pMafcoabo99qsjxabay3Lou5ljGcDOOal1Hw5q+mwfaL/TriCAMF8x1GMnoOtem/CHT/svh+W+k4e7k4J/uJwP13Gt278nxT4NlMIGLuAtH7OCcfqtDv0FdM8P05JJJ4oYEZ5ZGCKo6sT0FdlbaBr6fe0i74/2R/jXN+GMf8JJpfGD9qi49PmHFfQ/nRpPFE3WUsF+oGf5ZpNXK1R5xoUksV4bedGjmjba6MOVPoa9g0nS7/yl3Wso+orgLnTQ3xFtVUfu7spKfw4b/wBBr3XTnDEr3UAn8c1Chc0VRowbe2lScQsjCT+6etasen3P/PB/ypWH/FQp/vL/ACrfnlMEIcAHkDmlGldlyqtGFJayxLl42Ue4qs1tNMhMUbPjg4rsISs8Ckrw45FZ9kgRZ1HZ8UTohGuzip1khmKSqVcdjU9rFLOSIkZ2Aycdqsa7HnVJD7D+VXfDiYnl/wBz+tccabcrHXKp7tym1ldkf8e8n5VQubeSGTbIhRuuDXW31zJbuojt2lBGSRnj9K5/U5mnuSzxGM4A2mtXBGcZt6mV5hjatfTrrcBzWNdL1pbGYo2CadNODCdpI61Jd3elY1m28/Aq15uR1rvi7nHJWJGOayNRyAa0DJWXqMny1oiDm9WbdC6+1eKeNIyssnHc17HqEuQwrynx0VVmNZMc9jy26BDmmIT3qzd4ZzzVYcZqUZ9B+c0+2A+1wf8AXRf51EOlS2gJu4f+ui/zqnYEUnP7xvqa3PCt1q2n3kmoaLFJI1uo84Km9ShPRgOcZH4VhSf6xvqa6r4feJ4PDN7dSXUE00dwipmJgCuDnOD1qRnp/grxjH4keaBrSS2u4UDvg7kIzjg9QeehrlPiroECX+nXGnRLFc30pgdEGA78YbHrzzWvJ8UNEVCYra+dzzt8tVyfrmuTPjdNQ8W2eqarbyCysgxgt4SGIYjgknGT3/AUdQPW00wQ6B/ZdpJ5W22+zpIFyV+XG7Hfuag8J6O/h/Ro9Pa5NwsbsyOY9mATnGMnvn86828a+PotX0uK20hb21k80O8jMEO0A8Aqc9TWd4I8ZPot9cvqst5d28sYULv3lWByCNx9M0CJ9TsP7K+KEECDEUl7FNH/ALrsD/PI/CvTvF9//Z0miXJbCLqCI/8AusrKf515n4n8V6Zquv6NqVtb3SNZyAyhwuXQMGGMHr16+tWfHXjSx8Q6VDa2UF1FKk4l3ShQMYI7E880ug7nttnbLJrdjdsBvt0kQf8AAsY/r+ddr4WvBdXGoupyqTCMfQDH+NeF6L8TtPWCBZba7NyI1DEBdpYDk9ema7P4deKrezs5kuRI0krh8pj056mqitRpnppYf8JEg/2l/lXQzyxRxBp+UyB0zzXCW+sRTaut2ocRgg4OM8Ct261aG6twkauDkHLYrSMQkzWm1WMIRACT0BIwBRpjb4pf97+lc+JfetDTtQjt43WQMSzZGKqUdCUyDVbdn1CQhWI45A9qt6HCUnlyMHZ3+tWk1WH+5J+lRxX0a3csxVtrgADvWCppamzqNqxPe3P2ZgPKd8jPy1zmpt59y8uxkDY4brXQtqsP9yT9KxNZu0uZVZAwAXHzVMqZUJ2Zh3AGDRBbRSW9riVIp5HdVypO85GAT2qvfXAUHJqnb6zNEqxRmPCklWKAspPUg9qjl0L5tTobaJhEHL4j8suTjoQcbfrmtDTSskEzsiOylQN77QAc965yG+H9nrboXyX3yFjxn0H86kS8ZIHjBGxiCePTpWtMiaOhSKKW4uNm5ogdiEc/Men4Cs2SNJbPzZE3GN33IDgvgD5R+uax7rWJIoRHHLsVSW+U4JPvWLfeIpmmVvMRWWUygqMfMRg10JOxgT3CRSR6a5jUGeVg4GcEbwMfka8/8YfYY49babSLaf7AC6F5JBvzKFwcH0Pb0rrl8RvCp2tABvMigxg+Wx6lc9K4jxHqMUltexhlIul2SkjJI3Bvw5FZcrZUmcXpOgJq2i6lei1kjmmZ/sSRBmRPLG5wT7j5RnuKgFlYXHhmJtNtba4uVjBu5nmYTW7F8Z2dDHgjkZ684qGbXdQsZLIWVy0UVkMRRpkIfmz865wxJPOapP4hvWsJbNEtIYpFMbtFbqsjIW3FN/XGaViL6nQ3FlpD6tqegwacYprOCVkvvNYuzxruJZfu7TzwOnFcVZylrq395F/nWreeJtUurOWCV4AZYxFLMsCrNKg/hZxyRwKxrRSL23P/AE0X+YqR3YyWCXzGxFL1P8BpnkTf88Zf++DRRTEOEEx/5ZSf98GniGb/AJ5Sf98miigA8iX/AJ5Sf98GjyJf+eUn/fJoooAUQy/88pP++DTxDL/zyk/75NFFIC3aJIrglHH/AAE13fhzUfJ2bmC/U4oopx0A9H0nXLdUXfdwD6yL/jXS2mvWOBm/tB9Z0/xoorpgyWaCa9p3/QQs/wDwIT/GpBrmm5/5CNl/4EJ/jRRQ2JFmLXdMx/yEbH/wJT/Gntr+mAcalY/+BKf40UVnc0uRSa9puM/2jY/+BCf41n3mv6dg41CzJ9p0/wAaKKLjTOU1fxBachLqFvpIp/rWPBrkG/JuIv8AvsUUVlLcpSZsWuv2oA3XUA/7aL/jUV/4ntUjOy5iY+zg0UVcAk2cjqXi07iFYke3NYF14jlckgP+Rooq5SZktzJuteumB2CT/vk1jXN/dzZ3LMc/7JoorNyZXMUWMzH5o5f++DTdkn/PKT/vg0UVIczGskv/ADxk/wC+DTrRJvtkGYpAPMXkofWiigLs/9k=";
  // ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

  //ファイル選択時の処理
  var ofd = document.getElementById("selectfile");
  ofd.addEventListener("change",function(evt){
    var img = null;
    var file = evt.target.files;
    var reader = new FileReader();
    //dataURL形式でファイルを読み込む
    reader.readAsDataURL(file[0]);
    reader.onload = function(){
      //■ファイルのロード完了時の処理■
      img = new Image();
      img.onload = function(){
        //■画像の読込完了時の処理■
        var originalWidth = img.width;
        var originalHeight = img.height;
        var width = originalWidth;
        var height = originalHeight;

        var imgShrinkPix = 1280;
        if (document.getElementById("imgShrink").checked) {
          if ( originalWidth > imgShrinkPix || originalHeight > imgShrinkPix){
            var imgRatio =  imgShrinkPix / Math.max(originalWidth, originalHeight);
            width = Math.round(imgRatio * width);
            height = Math.round(imgRatio * height);
          }
        }
        var srcCanvas = document.getElementById("srcCanvas");
        var srcContext = srcCanvas.getContext('2d');

        var dispRatio = 0.5 / Math.floor( Math.max(512, Math.max(width, height)) / 512 );
        var dispWidth = Math.round(dispRatio * width);
        var dispHeight = Math.round(dispRatio * height);
        srcCanvas.width = width;
        srcCanvas.height = height;
        // 元画像の描画
        srcContext.drawImage(img, 0, 0, originalWidth, originalHeight, 0, 0, width, height);  // 元画像をキャンバス(非表示)に描画
        var dataSrcUrl = srcCanvas.toDataURL(); // 元画像のbase64データ(URL)をキャンバス(非表示)から取得
        var srcImgDoc = document.getElementById("srcImg"); // 元画像用のimg要素にbase64データ(URL)データを入れて画像を表示
        srcImgDoc.src = dataSrcUrl;
        srcImgDoc.width = dispWidth;
        srcImgDoc.height = dispHeight;
        if (document.getElementById("negativeCheckBox1").checked){   //ネガが[チェック]のとき
          negativeImage()
        }else{                                                       //それ以外
          srcImgDoc.style.visibility='visible';
          interferanceColorFilter();//　干渉色処理と処理画像の描画
        }
      };
      img.src = reader.result;
    };
  }, false);
});
</script>
</body>
</html>
